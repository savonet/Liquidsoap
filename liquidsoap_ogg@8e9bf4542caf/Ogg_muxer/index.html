<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Ogg_muxer (liquidsoap_ogg@8e9bf4542caf.Ogg_muxer)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.4"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">liquidsoap_ogg@8e9bf4542caf</a> &#x00BB; Ogg_muxer</nav><header class="odoc-preamble"><h1>Module <code><span>Ogg_muxer</span></code></h1><p>Ogg Stream Encoder</p></header><nav class="odoc-toc"><ul><li><a href="#types">Types</a></li><li><a href="#api">API</a></li><li><a href="#utils">Utils</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-log"><a href="#val-log" class="anchor"></a><code><span><span class="keyword">val</span> log : <a href="../../liquidsoap_core@8e9bf4542caf/Log/index.html#type-t">Log.t</a></span></code></div></div><h3 id="types"><a href="#types" class="anchor"></a>Types</h3><div class="odoc-spec"><div class="spec exception anchored" id="exception-Invalid_data"><a href="#exception-Invalid_data" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Invalid_data</span></span></code></div></div><div class="odoc-spec"><div class="spec exception anchored" id="exception-Invalid_usage"><a href="#exception-Invalid_usage" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Invalid_usage</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-audio"><a href="#type-audio" class="anchor"></a><code><span><span class="keyword">type</span> audio</span><span> = <span class="xref-unresolved">Mm</span>.Audio.t</span></code></div><div class="spec-doc"><p>Audio data type</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-video"><a href="#type-video" class="anchor"></a><code><span><span class="keyword">type</span> video</span><span> = <span class="xref-unresolved">Mm</span>.Video.buffer</span></code></div><div class="spec-doc"><p>Video data type</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-data"><a href="#type-data" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a data</span></span><span> = </span><span>{</span></code><ol><li id="type-data.data" class="def record field anchored"><a href="#type-data.data" class="anchor"></a><code><span>data : <span class="type-var">'a</span>;</span></code></li><li id="type-data.offset" class="def record field anchored"><a href="#type-data.offset" class="anchor"></a><code><span>offset : int;</span></code></li><li id="type-data.length" class="def record field anchored"><a href="#type-data.length" class="anchor"></a><code><span>length : int;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>A data unit</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-track_data"><a href="#type-track_data" class="anchor"></a><code><span><span class="keyword">type</span> track_data</span><span> = </span></code><ol><li id="type-track_data.Audio_data" class="def variant constructor anchored"><a href="#type-track_data.Audio_data" class="anchor"></a><code><span>| </span><span><span class="constructor">Audio_data</span> <span class="keyword">of</span> <span><a href="#type-audio">audio</a> <a href="#type-data">data</a></span></span></code></li><li id="type-track_data.Video_data" class="def variant constructor anchored"><a href="#type-track_data.Video_data" class="anchor"></a><code><span>| </span><span><span class="constructor">Video_data</span> <span class="keyword">of</span> <span><a href="#type-video">video</a> <a href="#type-data">data</a></span></span></code></li></ol></div><div class="spec-doc"><p>A track data is a data unit of either audio or video.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-track_encoder"><a href="#type-track_encoder" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a track_encoder</span></span><span> =
  <span><span><span class="type-var">'a</span> <a href="#type-data">data</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../../ogg/Ogg/Stream/index.html#type-stream">Ogg.Stream.stream</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="../../ogg/Ogg/Page/index.html#type-t">Ogg.Page.t</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p>A track encoder takes the track data, * the ogg logical stream, and fills the stream. * If the encoding process outputs ogg pages, then * the encoder should use the last argument to add its pages * to the stream.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-header_encoder"><a href="#type-header_encoder" class="anchor"></a><code><span><span class="keyword">type</span> header_encoder</span><span> = <span><a href="../../ogg/Ogg/Stream/index.html#type-stream">Ogg.Stream.stream</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../ogg/Ogg/Page/index.html#type-t">Ogg.Page.t</a></span></code></div><div class="spec-doc"><p>Returns the first page of the stream, * to be placed at the very beginning.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-position"><a href="#type-position" class="anchor"></a><code><span><span class="keyword">type</span> position</span><span> = </span></code><ol><li id="type-position.Unknown" class="def variant constructor anchored"><a href="#type-position.Unknown" class="anchor"></a><code><span>| </span><span><span class="constructor">Unknown</span></span></code></li><li id="type-position.Time" class="def variant constructor anchored"><a href="#type-position.Time" class="anchor"></a><code><span>| </span><span><span class="constructor">Time</span> <span class="keyword">of</span> float</span></code></li></ol></div><div class="spec-doc"><p>Return the end time of a page, in milliseconds.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-page_end_time"><a href="#type-page_end_time" class="anchor"></a><code><span><span class="keyword">type</span> page_end_time</span><span> = <span><a href="../../ogg/Ogg/Page/index.html#type-t">Ogg.Page.t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-position">position</a></span></code></div><div class="spec-doc"><p>Type for a function returning a page's ending time.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-fisbone_packet"><a href="#type-fisbone_packet" class="anchor"></a><code><span><span class="keyword">type</span> fisbone_packet</span><span> = <span><a href="../../ogg/Ogg/Stream/index.html#type-stream">Ogg.Stream.stream</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../ogg/Ogg/Stream/index.html#type-packet">Ogg.Stream.packet</a> option</span></span></code></div><div class="spec-doc"><p>Returns an optional fisbone packet, which * will contain the data for this stream to * put in the ogg skeleton, if enabled in * the encoder.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-stream_start"><a href="#type-stream_start" class="anchor"></a><code><span><span class="keyword">type</span> stream_start</span><span> = <span><a href="../../ogg/Ogg/Stream/index.html#type-stream">Ogg.Stream.stream</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../ogg/Ogg/Page/index.html#type-t">Ogg.Page.t</a> list</span></span></code></div><div class="spec-doc"><p>Returns the remaining header data, before data encoding starts.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-end_of_stream"><a href="#type-end_of_stream" class="anchor"></a><code><span><span class="keyword">type</span> end_of_stream</span><span> = <span><a href="../../ogg/Ogg/Stream/index.html#type-stream">Ogg.Stream.stream</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../ogg/Ogg/Page/index.html#type-t">Ogg.Page.t</a> list</span></span></code></div><div class="spec-doc"><p>Ends the track.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-data_encoder"><a href="#type-data_encoder" class="anchor"></a><code><span><span class="keyword">type</span> data_encoder</span><span> = </span></code><ol><li id="type-data_encoder.Audio_encoder" class="def variant constructor anchored"><a href="#type-data_encoder.Audio_encoder" class="anchor"></a><code><span>| </span><span><span class="constructor">Audio_encoder</span> <span class="keyword">of</span> <span><a href="#type-audio">audio</a> <a href="#type-track_encoder">track_encoder</a></span></span></code></li><li id="type-data_encoder.Video_encoder" class="def variant constructor anchored"><a href="#type-data_encoder.Video_encoder" class="anchor"></a><code><span>| </span><span><span class="constructor">Video_encoder</span> <span class="keyword">of</span> <span><a href="#type-video">video</a> <a href="#type-track_encoder">track_encoder</a></span></span></code></li></ol></div><div class="spec-doc"><p>A data encoder is an encoder for either a audio or a video track.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-stream_encoder"><a href="#type-stream_encoder" class="anchor"></a><code><span><span class="keyword">type</span> stream_encoder</span><span> = </span><span>{</span></code><ol><li id="type-stream_encoder.header_encoder" class="def record field anchored"><a href="#type-stream_encoder.header_encoder" class="anchor"></a><code><span>header_encoder : <a href="#type-header_encoder">header_encoder</a>;</span></code></li><li id="type-stream_encoder.fisbone_packet" class="def record field anchored"><a href="#type-stream_encoder.fisbone_packet" class="anchor"></a><code><span>fisbone_packet : <a href="#type-fisbone_packet">fisbone_packet</a>;</span></code></li><li id="type-stream_encoder.stream_start" class="def record field anchored"><a href="#type-stream_encoder.stream_start" class="anchor"></a><code><span>stream_start : <a href="#type-stream_start">stream_start</a>;</span></code></li><li id="type-stream_encoder.data_encoder" class="def record field anchored"><a href="#type-stream_encoder.data_encoder" class="anchor"></a><code><span>data_encoder : <a href="#type-data_encoder">data_encoder</a>;</span></code></li><li id="type-stream_encoder.end_of_page" class="def record field anchored"><a href="#type-stream_encoder.end_of_page" class="anchor"></a><code><span>end_of_page : <a href="#type-page_end_time">page_end_time</a>;</span></code></li><li id="type-stream_encoder.end_of_stream" class="def record field anchored"><a href="#type-stream_encoder.end_of_stream" class="anchor"></a><code><span>end_of_stream : <a href="#type-end_of_stream">end_of_stream</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The full stream encoder type.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>Main type for the ogg encoder</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-state"><a href="#type-state" class="anchor"></a><code><span><span class="keyword">type</span> state</span><span> = </span></code><ol><li id="type-state.Eos" class="def variant constructor anchored"><a href="#type-state.Eos" class="anchor"></a><code><span>| </span><span><span class="constructor">Eos</span></span></code></li><li id="type-state.Streaming" class="def variant constructor anchored"><a href="#type-state.Streaming" class="anchor"></a><code><span>| </span><span><span class="constructor">Streaming</span></span></code></li><li id="type-state.Bos" class="def variant constructor anchored"><a href="#type-state.Bos" class="anchor"></a><code><span>| </span><span><span class="constructor">Bos</span></span></code></li></ol></div><div class="spec-doc"><p>You may register new tracks on state Eos or Bos. * You can't register new track on state Streaming.</p></div></div><h3 id="api"><a href="#api" class="anchor"></a>API</h3><p>Usage: * * Encoding: * * - <code>create ~skeleton name</code> : create a new encoder * - <code>register_track encoder stream_encoder</code> : register a new track * - ibid * - (...) * - <code>streams_start encoder</code> : start the tracks (optional) * - <code>encode encoder track_serial track_data</code> : encode data for one track * - ibid * - (...) * - (encode data for other tracks) * - <code>end_of_track encoder track_serial</code> : ends a track. (track end do not need to be simultaneous) * - (...) * - <code>end_of_stream encoder</code>: ends all tracks as well as the encoder. Set Eos state on the encoder. * - <code>register_track encoder stream_encoder</code> : register a new track, starts a new sequentialized stream * - And so on.. * * You get encoded data by calling <code>get_data</code>, <code>peek_data</code>. * * See: http://xiph.org/ogg/doc/oggstream.html for more details on the * specifications of an ogg stream. This API reflects exactly what is recommended to do.</p><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span><span class="label">skeleton</span>:bool <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Create a new encoder. * Add an ogg skeleton if <code>skeleton</code> is <code>true</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-state"><a href="#val-state" class="anchor"></a><code><span><span class="keyword">val</span> state : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-state">state</a></span></code></div><div class="spec-doc"><p>Get the state of an encoder.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_data"><a href="#val-get_data" class="anchor"></a><code><span><span class="keyword">val</span> get_data : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../liquidsoap_core@8e9bf4542caf/Strings/index.html#type-t">Strings.t</a></span></code></div><div class="spec-doc"><p>Get and remove encoded data..</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_header"><a href="#val-get_header" class="anchor"></a><code><span><span class="keyword">val</span> get_header : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../liquidsoap_core@8e9bf4542caf/Strings/index.html#type-t">Strings.t</a></span></code></div><div class="spec-doc"><p>Get header of a stream.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-peek_data"><a href="#val-peek_data" class="anchor"></a><code><span><span class="keyword">val</span> peek_data : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../../liquidsoap_core@8e9bf4542caf/Strings/index.html#type-t">Strings.t</a></span></code></div><div class="spec-doc"><p>Peek encoded data without removing it.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-register_track"><a href="#val-register_track" class="anchor"></a><code><span><span class="keyword">val</span> register_track : <span><span class="optlabel">?fill</span>:int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-stream_encoder">stream_encoder</a> <span class="arrow">&#45;&gt;</span></span> nativeint</span></code></div><div class="spec-doc"><p>Register a new track to the stream. * The state needs to be <code>Bos</code> or <code>Eos</code>. * * <code>fill</code> parameter is used to try to control ogg * logical page's size. See <code>Ogg.get_page</code> for more * details. * * Returns the serial number of the registered ogg * stream.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-streams_start"><a href="#val-streams_start" class="anchor"></a><code><span><span class="keyword">val</span> streams_start : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Start streams, set state to <code>Streaming</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-encode"><a href="#val-encode" class="anchor"></a><code><span><span class="keyword">val</span> encode : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>nativeint <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-track_data">track_data</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Encode data. Implicitly calls <code>streams_start</code> * if not called before. Fails if state is not <code>Streaming</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-end_of_track"><a href="#val-end_of_track" class="anchor"></a><code><span><span class="keyword">val</span> end_of_track : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>nativeint <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Finish a track. Raises <code>Not_found</code> if * no such track exists.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-end_of_stream"><a href="#val-end_of_stream" class="anchor"></a><code><span><span class="keyword">val</span> end_of_stream : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Ends all tracks, flush remaining encoded data. * Set state to <code>Eos</code>.</p></div></div><h3 id="utils"><a href="#utils" class="anchor"></a>Utils</h3><div class="odoc-spec"><div class="spec value anchored" id="val-flush_pages"><a href="#val-flush_pages" class="anchor"></a><code><span><span class="keyword">val</span> flush_pages : <span><a href="../../ogg/Ogg/Stream/index.html#type-stream">Ogg.Stream.stream</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../ogg/Ogg/Page/index.html#type-t">Ogg.Page.t</a> list</span></span></code></div><div class="spec-doc"><p>flush all availables pages from an ogg stream</p></div></div></div></body></html>
