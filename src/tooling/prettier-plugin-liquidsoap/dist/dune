(rule
 (mode
  (promote (until-clean)))
 (deps ../src/liquidsoap_js.bc.js)
 (target liquidsoap.js)
 (action
  (copy %{deps} %{target})))

(rule
 (mode
  (promote (until-clean)))
 (target web.mjs)
 (deps
  ../package-lock.json
  ../src/base.mjs
  ../webpack.web.js
  ./liquidsoap.js)
 (action
  (chdir
   ..
   (run npm run build:web))))

(rule
 (mode
  (promote (until-clean)))
 (target node.js)
 (deps
  ../package-lock.json
  ../src/base.mjs
  ../src/index.mjs
  ../webpack.node.js
  ./liquidsoap.js)
 (action
  (chdir
   ..
   (run npm run build:node))))
