<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Request (liquidsoap_core@8e9bf4542caf.Request)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.4"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">liquidsoap_core@8e9bf4542caf</a> &#x00BB; Request</nav><header class="odoc-preamble"><h1>Module <code><span>Request</span></code></h1><p>A request is something from which we can produce a file.</p></header><nav class="odoc-toc"><ul><li><a href="#general-management">General management</a></li><li><a href="#resolving">Resolving</a></li><li><a href="#metadatas">Metadatas</a></li><li><a href="#logging">Logging</a></li><li><a href="#media-operations">Media operations</a></li><li><a href="#plugs">Plugs</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-indicator"><a href="#type-indicator" class="anchor"></a><code><span><span class="keyword">type</span> indicator</span></code></div><div class="spec-doc"><p>An indicator is a resource location (URI), when meaningful, it can be declared as temporary if liquidsoap should destroy it after usage (this means deleting a local file).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-conf"><a href="#val-conf" class="anchor"></a><code><span><span class="keyword">val</span> conf : <span class="xref-unresolved">Dtools</span>.Conf.ut</span></code></div><div class="spec-doc"><p>Root configuration node.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-indicator"><a href="#val-indicator" class="anchor"></a><code><span><span class="keyword">val</span> indicator : 
  <span><span class="optlabel">?metadata</span>:<a href="../Frame/index.html#type-metadata">Frame.metadata</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?temporary</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-indicator">indicator</a></span></code></div><div class="spec-doc"><p>Create an indicator.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pretty_date"><a href="#val-pretty_date" class="anchor"></a><code><span><span class="keyword">val</span> pretty_date : <span><span class="xref-unresolved">Unix</span>.tm <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Return a prettified string.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>Type of requests, which are devices for obtaining a local file from an URI.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : 
  <span><span class="optlabel">?resolve_metadata</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?excluded_metadata_resolvers</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?metadata</span>:<a href="../Frame/Metadata/index.html#type-t">Frame.Metadata.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?persistent</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?temporary</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">cue_in_metadata</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">cue_out_metadata</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p>Create a request.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-initial_uri"><a href="#val-initial_uri" class="anchor"></a><code><span><span class="keyword">val</span> initial_uri : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>Return the request's initial uri.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-destroy"><a href="#val-destroy" class="anchor"></a><code><span><span class="keyword">val</span> destroy : <span><span class="optlabel">?force</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Destroying of a requests causes its file to be deleted if it's a temporary one, for example a downloaded file. If the metadata <code>&quot;persistent&quot;</code> is set to <code>&quot;true&quot;</code>, destroying doesn't happen, unless <code>force</code> is set too. Persistent sources are useful for static URIs (see below for the definition of staticity, and in <code>src/sources/one_file.ml</code> for an example of use).</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-resolving"><a href="#type-resolving" class="anchor"></a><code><span><span class="keyword">type</span> resolving</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-status"><a href="#type-status" class="anchor"></a><code><span><span class="keyword">type</span> status</span><span> = </span><span>[ </span></code><ol><li id="type-status.Idle" class="def variant constructor anchored"><a href="#type-status.Idle" class="anchor"></a><code><span>| </span><span>`Idle</span></code></li><li id="type-status.Resolving" class="def variant constructor anchored"><a href="#type-status.Resolving" class="anchor"></a><code><span>| </span><span>`Resolving <span class="keyword">of</span> <a href="#type-resolving">resolving</a></span></code></li><li id="type-status.Ready" class="def variant constructor anchored"><a href="#type-status.Ready" class="anchor"></a><code><span>| </span><span>`Ready</span></code></li><li id="type-status.Destroyed" class="def variant constructor anchored"><a href="#type-status.Destroyed" class="anchor"></a><code><span>| </span><span>`Destroyed</span></code></li><li id="type-status.Failed" class="def variant constructor anchored"><a href="#type-status.Failed" class="anchor"></a><code><span>| </span><span>`Failed</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>Status of a request.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-status"><a href="#val-status" class="anchor"></a><code><span><span class="keyword">val</span> status : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-status">status</a></span></code></div><div class="spec-doc"><p>Current status of a request.</p></div></div><h2 id="general-management"><a href="#general-management" class="anchor"></a>General management</h2><div class="odoc-spec"><div class="spec value anchored" id="val-cleanup"><a href="#val-cleanup" class="anchor"></a><code><span><span class="keyword">val</span> cleanup : <span>unit <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Called at exit, for cleaning temporary files and destroying all the requests, even persistent ones.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-id"><a href="#val-id" class="anchor"></a><code><span><span class="keyword">val</span> id : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Identifier of a request.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-all"><a href="#val-all" class="anchor"></a><code><span><span class="keyword">val</span> all : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> list</span></span></code></div><div class="spec-doc"><p>Get the list of all requests.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-from_id"><a href="#val-from_id" class="anchor"></a><code><span><span class="keyword">val</span> from_id : <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> option</span></span></code></div><div class="spec-doc"><p>Retrieve a request from its id.</p></div></div><h2 id="resolving"><a href="#resolving" class="anchor"></a>Resolving</h2><p>Resolving consists in many steps. Every step consist in rewriting the first URI into other URIs. The process ends when the last URI is a local filename. For example, the initial URI can be a database query, which is then turned into a remote locations, which is then tentatively downloaded... At each step <code>protocol.resolve uri timeout</code> is called, and the function is expected to push the new URIs in the request.</p><div class="odoc-spec"><div class="spec type anchored" id="type-resolver"><a href="#type-resolver" class="anchor"></a><code><span><span class="keyword">type</span> resolver</span><span> = <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="label">log</span>:<span>(<span>string <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span>float <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-indicator">indicator</a> option</span></span></code></div><div class="spec-doc"><p>Something that resolves an URI.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-protocol"><a href="#type-protocol" class="anchor"></a><code><span><span class="keyword">type</span> protocol</span><span> = </span><span>{</span></code><ol><li id="type-protocol.resolve" class="def record field anchored"><a href="#type-protocol.resolve" class="anchor"></a><code><span>resolve : <a href="#type-resolver">resolver</a>;</span></code></li><li id="type-protocol.static" class="def record field anchored"><a href="#type-protocol.static" class="anchor"></a><code><span>static : <span>string <span class="arrow">&#45;&gt;</span></span> bool;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>A protocol, which can resolve associated URIs.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_static"><a href="#val-is_static" class="anchor"></a><code><span><span class="keyword">val</span> is_static : <span>string <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>A static request <code>r</code> is such that every resolving leads to the same file. Sometimes, it allows removing useless destroy/create/resolve.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-resolve_flag"><a href="#type-resolve_flag" class="anchor"></a><code><span><span class="keyword">type</span> resolve_flag</span><span> = </span><span>[ </span></code><ol><li id="type-resolve_flag.Resolved" class="def variant constructor anchored"><a href="#type-resolve_flag.Resolved" class="anchor"></a><code><span>| </span><span>`Resolved</span></code></li><li id="type-resolve_flag.Failed" class="def variant constructor anchored"><a href="#type-resolve_flag.Failed" class="anchor"></a><code><span>| </span><span>`Failed</span></code></li><li id="type-resolve_flag.Timeout" class="def variant constructor anchored"><a href="#type-resolve_flag.Timeout" class="anchor"></a><code><span>| </span><span>`Timeout</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>Resolving can fail because an URI is invalid, or doesn't refer to a valid * audio file, or simply because there was no enough time left.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-conf_metadata_decoder_priorities"><a href="#val-conf_metadata_decoder_priorities" class="anchor"></a><code><span><span class="keyword">val</span> conf_metadata_decoder_priorities : <span class="xref-unresolved">Dtools</span>.Conf.ut</span></code></div><div class="spec-doc"><p>Metadata resolvers priorities.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_metadata"><a href="#val-read_metadata" class="anchor"></a><code><span><span class="keyword">val</span> read_metadata : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Read the request's metadata.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-resolve"><a href="#val-resolve" class="anchor"></a><code><span><span class="keyword">val</span> resolve : <span><span class="optlabel">?timeout</span>:float <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-resolve_flag">resolve_flag</a></span></code></div><div class="spec-doc"><p><code>resolve ?timeout request</code> tries to resolve the request within <code>timeout</code> seconds. Defaults to <code>settings.request.timeout</code> when <code>timeout</code> is not passed.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-resolved"><a href="#val-resolved" class="anchor"></a><code><span><span class="keyword">val</span> resolved : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>resolved r</code> if there's an available local filename. It can be true even if the resolving hasn't been run, if the initial URI was already a local filename.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_filename"><a href="#val-get_filename" class="anchor"></a><code><span><span class="keyword">val</span> get_filename : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>string option</span></span></code></div><div class="spec-doc"><p>Return a valid local filename if there is one, which means that the request is ready.</p></div></div><h2 id="metadatas"><a href="#metadatas" class="anchor"></a>Metadatas</h2><div class="odoc-spec"><div class="spec value anchored" id="val-metadata"><a href="#val-metadata" class="anchor"></a><code><span><span class="keyword">val</span> metadata : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <a href="../Frame/index.html#type-metadata">Frame.metadata</a></span></code></div><div class="spec-doc"><p>Metadata are resolved from the first indicator to the last, the last one overriding the ones before. The only exception are root metadata, which are metadata internal to liquidsoap such as request id and etc. These cannot be overridden by resolvers.</p></div></div><h2 id="logging"><a href="#logging" class="anchor"></a>Logging</h2><p>Every request has a separate log in which its history can be written.</p><div class="odoc-spec"><div class="spec value anchored" id="val-log"><a href="#val-log" class="anchor"></a><code><span><span class="keyword">val</span> log : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><h2 id="media-operations"><a href="#media-operations" class="anchor"></a>Media operations</h2><p>These operations are only meaningful for media requests, and might raise exceptions otherwise.</p><div class="odoc-spec"><div class="spec value anchored" id="val-conf_dresolvers"><a href="#val-conf_dresolvers" class="anchor"></a><code><span><span class="keyword">val</span> conf_dresolvers : <span><span>string list</span> <span class="xref-unresolved">Dtools</span>.Conf.t</span></span></code></div><div class="spec-doc"><p>Duration resolvers.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-duration"><a href="#val-duration" class="anchor"></a><code><span><span class="keyword">val</span> duration : 
  <span><span class="optlabel">?resolvers</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">metadata</span>:<a href="../Frame/index.html#type-metadata">Frame.metadata</a> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span>float option</span></span></code></div><div class="spec-doc"><p><code>duration ?resolvers ~metadata filename</code> computes the duration of audio data contained in <code>filename</code>. The computation may be expensive. Set <code>resolvers</code> to a list of specific decoders to use for getting duration.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <code>Not_found</code> <p>if no duration computation method is found.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-has_decoder"><a href="#val-has_decoder" class="anchor"></a><code><span><span class="keyword">val</span> has_decoder : <span><span class="label">ctype</span>:<a href="../Frame/index.html#type-content_type">Frame.content_type</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>true</code> is a decoder exists for the given content-type.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_decoder"><a href="#val-get_decoder" class="anchor"></a><code><span><span class="keyword">val</span> get_decoder : 
  <span><span class="label">ctype</span>:<a href="../Frame/index.html#type-content_type">Frame.content_type</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Decoder/index.html#type-file_decoder_ops">Decoder.file_decoder_ops</a> option</span></span></code></div><div class="spec-doc"><p>Return a decoder if the file has been resolved, guaranteed to have available data to deliver.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-on_air"><a href="#val-on_air" class="anchor"></a><code><span><span class="keyword">val</span> on_air : <span><span class="label">source</span>:<a href="../Source/class-source/index.html">Source.source</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Mark the request as being on_air for the given source.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-done_playing"><a href="#val-done_playing" class="anchor"></a><code><span><span class="keyword">val</span> done_playing : <span><span class="label">source</span>:<a href="../Source/class-source/index.html">Source.source</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Mark the request as being done playing by the given source.</p></div></div><h2 id="plugs"><a href="#plugs" class="anchor"></a>Plugs</h2><div class="odoc-spec"><div class="spec type anchored" id="type-dresolver"><a href="#type-dresolver" class="anchor"></a><code><span><span class="keyword">type</span> dresolver</span><span> = </span><span>{</span></code><ol><li id="type-dresolver.dpriority" class="def record field anchored"><a href="#type-dresolver.dpriority" class="anchor"></a><code><span>dpriority : <span>unit <span class="arrow">&#45;&gt;</span></span> int;</span></code></li><li id="type-dresolver.file_extensions" class="def record field anchored"><a href="#type-dresolver.file_extensions" class="anchor"></a><code><span>file_extensions : <span>unit <span class="arrow">&#45;&gt;</span></span> <span>string list</span>;</span></code></li><li id="type-dresolver.dresolver" class="def record field anchored"><a href="#type-dresolver.dresolver" class="anchor"></a><code><span>dresolver : <span><span class="label">metadata</span>:<a href="../Frame/index.html#type-metadata">Frame.metadata</a> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> float;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-dresolvers"><a href="#val-dresolvers" class="anchor"></a><code><span><span class="keyword">val</span> dresolvers : <span><a href="#type-dresolver">dresolver</a> <a href="../Plug/index.html#type-t">Plug.t</a></span></span></code></div><div class="spec-doc"><p>Functions for computing duration.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-metadata_resolver"><a href="#type-metadata_resolver" class="anchor"></a><code><span><span class="keyword">type</span> metadata_resolver</span><span> = </span><span>{</span></code><ol><li id="type-metadata_resolver.priority" class="def record field anchored"><a href="#type-metadata_resolver.priority" class="anchor"></a><code><span>priority : <span>unit <span class="arrow">&#45;&gt;</span></span> int;</span></code></li><li id="type-metadata_resolver.resolver" class="def record field anchored"><a href="#type-metadata_resolver.resolver" class="anchor"></a><code><span>resolver : <span><span class="label">metadata</span>:<a href="../Frame/index.html#type-metadata">Frame.metadata</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">extension</span>:<span>string option</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">mime</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(string * string)</span> list</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>Type for a metadata resolver. Resolvers are executed in priority order and the first returned metadata take precedence over any other one later returned.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mresolvers"><a href="#val-mresolvers" class="anchor"></a><code><span><span class="keyword">val</span> mresolvers : <span><a href="#type-metadata_resolver">metadata_resolver</a> <a href="../Plug/index.html#type-t">Plug.t</a></span></span></code></div><div class="spec-doc"><p>Functions for resolving metadata. Metadata filling isn't included in Decoder because we want it to occur immediately after request resolution.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-resolve_metadata"><a href="#val-resolve_metadata" class="anchor"></a><code><span><span class="keyword">val</span> resolve_metadata : 
  <span><span class="label">initial_metadata</span>:<a href="../Frame/index.html#type-metadata">Frame.metadata</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">excluded</span>:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <a href="../Frame/index.html#type-metadata">Frame.metadata</a></span></code></div><div class="spec-doc"><p>Resolve metadata for a local file:</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-protocols"><a href="#val-protocols" class="anchor"></a><code><span><span class="keyword">val</span> protocols : <span><a href="#type-protocol">protocol</a> <a href="../Plug/index.html#type-t">Plug.t</a></span></span></code></div><div class="spec-doc"><p>Functions for resolving URIs.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Value"><a href="#module-Value" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Value/index.html">Value</a></span><span> : <a href="../../liquidsoap-lang/Liquidsoap_lang/Value/module-type-Custom/index.html">Value.Custom</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../liquidsoap-lang/Liquidsoap_lang/Value/module-type-Custom/index.html#type-content">content</a> := <a href="#type-t">t</a></span></span></code></div></div></div></body></html>
