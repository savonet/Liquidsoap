#!../../src/liquidsoap ../../libs/stdlib.liq ../../libs/deprecations.liq

%include "test.liq"

def t(x,y) =
  if x != y then test.fail() end
end

def f() =
  t(metadata.cover.remove([("a","A"),("apic","XXX"),("b","B"),("cover","YYY")]), [("a","A"),("b","B")])

  apic_cover = string.base64.decode("AGltYWdlL3BuZwADQWxidW0gY292ZXIAiVBORw0KGgoAAAANSUhEUgAAAIAAAACAEAIAAAAczCrfAAAACXBIWXMAAAAAAAAAAQCEeRdzAAACoklEQVR4nO3E4UYYAACF0StJkiRJkiRJkiRJkiRJkiTJli1btmzZsmXLli3atGnTpk2bNm3atEmSJEmSJEmSJEmSJEmSJEnS9h73Oz+O9N/VFbPvurxg9l0XZ8y+6/yE2XedHTH7rtMDZt91ssfsu453mH3X0Raz7zrcYPZdB2vMvmt/hdl37S0x+67dBWbftTPH7Lu2Z5h919YUs+/anGD2XRtjzL5rfYTZd60NMfuu1QFm37Xyh9l3Lf9i9l1LP5h91+I3Zt+18IXZd81/YvZdcx+YfdfsO2bfNfOG2XdNv2L2XVMtzL5rspnZd000Mfuu8UZm3zXWwOy7RuuZfddIHbPvGq5l9l1DNcy+a7Ca2XcNVDH7rv4KZt/1t4zZd/WVMPuu30XMvqu3gNl3/cxj9l09Ocy+63sWs+/qzmD2XV/TmH1XVwqz7/qcxOy7OhOYfdfHOGbf1RHD7LveRzH7rvYIZt/1NozZd7WFMPuu10HMvqs1gNl3tVwy+64X58y+q/mU2Xc9O2b2XU2HzL7ryT6z72rcZfZdj7aZfVfDJrPverDO7LvqV5l9171lZt9Vt8jsu+7MM/uu2llm33Vrmtl31Uwy+64b48y+q3qU2XddG2b2XVWDzL6rsp/Zd1X0Mfuu8l5m31XWw+y7SruZfVdJF7PvKu5k9l1FHcy+q7Cd2XcVtDH7rvxWZt+V95LZd+U+Z/ZdOU+ZfVf2Y2bflfWQ2Xdl3mf2XRl3mX1X+m1m35V2k9l3pV5n9l0plcy+K7mc2XcllTL7rsRiZt+VUMjsu+LzmX1XXC6z74rNZvZdMZnMvis6ndl3RaUy+67IZGbfFZHI7LvC45l9V1gss+8KjWb2XSGRzL4rOJzZdwWFMvuuwGBm3xUQyOw7YOsfJwPDsnrI0ewAAAAASUVORK5CYII=")

  parse_apic_data = string.apic.parse(apic_cover)

  expected_apic_string_data = string.base64.decode("iVBORw0KGgoAAAANSUhEUgAAAIAAAACAEAIAAAAczCrfAAAACXBIWXMAAAAAAAAAAQCEeRdzAAACoklEQVR4nO3E4UYYAACF0StJkiRJkiRJkiRJkiRJkiTJli1btmzZsmXLli3atGnTpk2bNm3atEmSJEmSJEmSJEmSJEmSJEnS9h73Oz+O9N/VFbPvurxg9l0XZ8y+6/yE2XedHTH7rtMDZt91ssfsu453mH3X0Raz7zrcYPZdB2vMvmt/hdl37S0x+67dBWbftTPH7Lu2Z5h919YUs+/anGD2XRtjzL5rfYTZd60NMfuu1QFm37Xyh9l3Lf9i9l1LP5h91+I3Zt+18IXZd81/YvZdcx+YfdfsO2bfNfOG2XdNv2L2XVMtzL5rspnZd000Mfuu8UZm3zXWwOy7RuuZfddIHbPvGq5l9l1DNcy+a7Ca2XcNVDH7rv4KZt/1t4zZd/WVMPuu30XMvqu3gNl3/cxj9l09Ocy+63sWs+/qzmD2XV/TmH1XVwqz7/qcxOy7OhOYfdfHOGbf1RHD7LveRzH7rvYIZt/1NozZd7WFMPuu10HMvqs1gNl3tVwy+64X58y+q/mU2Xc9O2b2XU2HzL7ryT6z72rcZfZdj7aZfVfDJrPverDO7LvqV5l9171lZt9Vt8jsu+7MM/uu2llm33Vrmtl31Uwy+64b48y+q3qU2XddG2b2XVWDzL6rsp/Zd1X0Mfuu8l5m31XWw+y7SruZfVdJF7PvKu5k9l1FHcy+q7Cd2XcVtDH7rvxWZt+V95LZd+U+Z/ZdOU+ZfVf2Y2bflfWQ2Xdl3mf2XRl3mX1X+m1m35V2k9l3pV5n9l0plcy+K7mc2XcllTL7rsRiZt+VUMjsu+LzmX1XXC6z74rNZvZdMZnMvis6ndl3RaUy+67IZGbfFZHI7LvC45l9V1gss+8KjWb2XSGRzL4rOJzZdwWFMvuuwGBm3xUQyOw7YOsfJwPDsnrI0ewAAAAASUVORK5CYII=")

  t(parse_apic_data, expected_apic_string_data.{description = "Album cover", picture_type = 3, mime = "image/png"})

  # From http://towerofbabel.free.fr/test/music.ogg
  flac_cover = string.base64.decode("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")

  parse_flac_cover = null.get(file.metadata.flac.cover.decode(flac_cover))

  excepted_flac_string_data = string.base64.decode("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")

  t(parse_flac_cover, excepted_flac_string_data.{picture_type = 3, mime = "image/jpeg", description = "", width = 0, height = 0, color_depth = 0, number_of_colors = null()})

  encoded_flac_cover = file.metadata.flac.cover.encode(
    picture_type=parse_flac_cover.picture_type,
    mime=parse_flac_cover.mime,
    description=parse_flac_cover.description,
    width=parse_flac_cover.width,
    height=parse_flac_cover.height,
    color_depth=parse_flac_cover.color_depth,
    number_of_colors=parse_flac_cover.number_of_colors,
    (parse_flac_cover:string))


  # The re-encoded tag doesn't match the original one b/c mime string has padding in it..
  expected_encoded_flac_codec = string.base64.decode("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")

  t(encoded_flac_cover, expected_encoded_flac_codec)

  test.pass()
end

def test_metadata_json_stringify() =
  file_metadata = [
    ("filename", "test.mp3"),
    ("temporary", "false"),
    ("initial_uri", "test.mp3"),
    ("encoder", "Lavf59.27.100"),
    ("status", "ready"),
    ("rid", "0"),
    ("artist", "Artist")
  ]
  expected_json_string = '{ "artist": "Artist" }'

  json_string = metadata.json.stringify(file_metadata)
  t(json_string, expected_json_string)

  empty_file_metadata = []
  expected_json_string = '{}'

  json_string = metadata.json.stringify(empty_file_metadata)
  t(json_string, expected_json_string)

  test.pass()
end

def test_metadata_json_parse() =
  metadata_json_string = '{"artist": "Artist"}'
  expected_parsed_metadata = [("artist", "Artist")]

  parsed_metadata = metadata.json.parse(metadata_json_string)
  t(parsed_metadata, expected_parsed_metadata)

  empty_metadata_json_string = '{}'
  expected_parsed_metadata = []

  parsed_metadata = metadata.json.parse(empty_metadata_json_string)
  t(parsed_metadata, expected_parsed_metadata)

  test.pass()
end

test.check(f)
test.check(test_metadata_json_stringify)
test.check(test_metadata_json_parse)
